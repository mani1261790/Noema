<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>pandas-basics</title>
  <link rel="stylesheet" href="/highlight/atom-one-dark.min.css" />
  <link rel="stylesheet" href="/katex/katex.min.css" />
  <style>
    :root {
      --bg-0: #f3f8fb;
      --bg-1: #d7e8f4;
      --bg-2: #f9f1e7;
      --text: #09162b;
      --muted: #44556f;
      --panel: rgba(255,255,255,.72);
      --border: rgba(255,255,255,.62);
      --code-bg: #09131a;
      --code-text: #e6f0f5;
      --shadow: 0 24px 54px rgba(10, 26, 54, 0.18), inset 0 1px 0 rgba(255,255,255,.62);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-0: #071225;
        --bg-1: #0f2238;
        --bg-2: #1a2f44;
        --text: #ebf3ff;
        --muted: #9db3cf;
        --panel: rgba(12, 21, 40, 0.74);
        --border: rgba(145, 183, 227, 0.33);
        --code-bg: #040b17;
        --code-text: #e4efff;
        --shadow: 0 30px 66px rgba(2, 7, 16, 0.58), inset 0 1px 0 rgba(166,205,255,.16);
      }
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      padding: 2rem 1rem;
      color: var(--text);
      font-family: "IBM Plex Sans", system-ui, sans-serif;
      background:
        radial-gradient(circle at 12% 12%, rgba(87,196,223,.18), transparent 44%),
        radial-gradient(circle at 88% 5%, rgba(255, 155, 96, 0.16), transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(109, 196, 255, 0.2), transparent 45%),
        linear-gradient(155deg, var(--bg-0) 0%, var(--bg-1) 48%, var(--bg-2) 100%);
    }
    main {
      max-width: 980px;
      margin: 0 auto;
      border-radius: 24px;
      border: 1px solid var(--border);
      background: var(--panel);
      backdrop-filter: blur(20px) saturate(145%);
      -webkit-backdrop-filter: blur(20px) saturate(145%);
      box-shadow: var(--shadow);
      padding: 1.25rem 1.25rem 1.5rem;
    }
    .prose-noema h1, .prose-noema h2, .prose-noema h3 {
      line-height: 1.25;
      margin-top: 1.25rem;
      margin-bottom: .65rem;
    }
    .prose-noema h1 { margin-top: .1rem; font-size: 1.8rem; }
    .prose-noema h2 { font-size: 1.35rem; }
    .prose-noema p {
      line-height: 1.85;
      color: var(--text);
      margin: .7rem 0;
    }
    .prose-noema ul, .prose-noema ol {
      margin: .7rem 0;
      padding-left: 1.4rem;
    }
    .prose-noema ul { list-style: disc; }
    .prose-noema ol { list-style: decimal; }
    .prose-noema li { margin: .28rem 0; line-height: 1.72; }
    .prose-noema a { color: inherit; text-underline-offset: 2px; }
    .prose-noema pre {
      background: var(--code-bg);
      color: var(--code-text);
      border-radius: 12px;
      padding: 1rem;
      overflow: auto;
      border: 1px solid rgba(255,255,255,.12);
    }
    .prose-noema code {
      font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
    }
    .prose-noema img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <main>
<article class="prose-noema">
<h1 id="pandasの使い方">Pandasの使い方</h1>
<p>Pandas は、表形式データ（行と列）を扱うためのライブラリです。<br>
CSV の読み込み、欠損値処理、集計、結合といった分析前処理の中心になります。</p>
<p>このノートでは、実務で頻出する <code>選択 → 加工 → 集計 → 結合</code> の流れを一通り体験します。</p>

<pre><code class="language-python">import numpy as np
import pandas as pd</code></pre>
<p>まずは DataFrame を手で作って、行・列の見方を掴みます。</p>

<pre><code class="language-python">df = pd.DataFrame({
    &quot;student&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;],
    &quot;grade&quot;: [1, 1, 2, 2, 2],
    &quot;math&quot;: [72, 88, 91, 67, 79],
    &quot;english&quot;: [75, 90, 85, 70, 82],
    &quot;club&quot;: [&quot;AI&quot;, &quot;Art&quot;, &quot;AI&quot;, &quot;Sports&quot;, &quot;AI&quot;],
})

df</code></pre>
<p>列選択と条件抽出は、Pandas の最も基本的な操作です。</p>

<pre><code class="language-python">print(df[[&quot;student&quot;, &quot;math&quot;]])
print(&quot;---&quot;)
print(df[df[&quot;math&quot;] &gt;= 80])</code></pre>
<p>新しい列を追加するときは、計算式を明示的に書きます。<br>
ここでは合計点と判定ラベルを作ります。</p>
<p><code>np.where(condition, true_value, false_value)</code> は、<br>
各行ごとに条件を判定して値を返すベクトル化された分岐です。</p>

<pre><code class="language-python">df[&quot;total&quot;] = df[&quot;math&quot;] + df[&quot;english&quot;]
df[&quot;pass&quot;] = np.where(df[&quot;total&quot;] &gt;= 160, &quot;pass&quot;, &quot;retry&quot;)

df</code></pre>
<p><code>groupby</code> は「同じカテゴリごとに集計する」操作です。<br>
クラブ別の平均点を見ると、分布の傾向をつかめます。</p>
<p><code>agg</code> の <code>students=(&quot;student&quot;, &quot;count&quot;)</code> は、<br>
「出力列名を students にして、student 列へ count 集計をかける」という意味です。<br>
<code>as_index=False</code> を指定しているので、集計キーの <code>club</code> を列として残したまま結果を扱えます。</p>

<pre><code class="language-python">club_summary = (
    df.groupby(&quot;club&quot;, as_index=False)
      .agg(
          students=(&quot;student&quot;, &quot;count&quot;),
          math_mean=(&quot;math&quot;, &quot;mean&quot;),
          english_mean=(&quot;english&quot;, &quot;mean&quot;),
      )
)

club_summary</code></pre>
<p>欠損値（NaN）は実データで必ず出ます。<br>
埋め方を決める前に、どこが欠損しているかを確認するのが先です。</p>

<pre><code class="language-python">df_missing = df.copy()
df_missing.loc[2, &quot;english&quot;] = np.nan

print(df_missing)
print(&quot;--- 欠損数 ---&quot;)
print(df_missing.isna().sum())</code></pre>
<p>今回はシンプルに列平均で埋めます。実務では、意味を踏まえて中央値やモデル補完を選びます。</p>

<pre><code class="language-python">filled = df_missing.copy()
filled[&quot;english&quot;] = filled[&quot;english&quot;].fillna(filled[&quot;english&quot;].mean())
filled</code></pre>
<p>表の結合（merge）は分析の中核です。キー列を揃えてから結合します。<br>
ここでは <code>how=&quot;left&quot;</code> を使い、左側（成績表）の行を必ず残しながら、<br>
一致する <code>student</code> があればプロフィール列を付与します。一致しない場合は NaN になります。</p>

<pre><code class="language-python">profile = pd.DataFrame({
    &quot;student&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;],
    &quot;city&quot;: [&quot;Tokyo&quot;, &quot;Osaka&quot;, &quot;Nagoya&quot;, &quot;Fukuoka&quot;, &quot;Tokyo&quot;],
    &quot;hours&quot;: [6.5, 4.0, 7.0, 3.5, 5.0],
})

merged = pd.merge(df, profile, on=&quot;student&quot;, how=&quot;left&quot;)
merged</code></pre>
<p>縦持ち・横持ちの変換もよく使います。<code>melt</code> で縦持ちにすると可視化しやすくなります。</p>
<ul>
<li><code>id_vars</code>: そのまま残す識別列（ここでは student, club）</li>
<li><code>value_vars</code>: 積み上げて1列にまとめる列（ここでは math, english）</li>
<li><code>var_name</code>, <code>value_name</code>: 変換後の列名（ここでは subject, score）</li>
</ul>

<pre><code class="language-python">long_df = merged.melt(
    id_vars=[&quot;student&quot;, &quot;club&quot;],
    value_vars=[&quot;math&quot;, &quot;english&quot;],
    var_name=&quot;subject&quot;,
    value_name=&quot;score&quot;
)

long_df.head(10)</code></pre>
<p>日付列を持つデータでは、<code>datetime</code> に変換してから月単位などで集計します。</p>

<pre><code class="language-python">sales = pd.DataFrame({
    &quot;date&quot;: [&quot;2026-01-02&quot;, &quot;2026-01-14&quot;, &quot;2026-02-03&quot;, &quot;2026-02-10&quot;, &quot;2026-03-01&quot;],
    &quot;amount&quot;: [120, 95, 140, 110, 180]
})

sales[&quot;date&quot;] = pd.to_datetime(sales[&quot;date&quot;])
sales[&quot;month&quot;] = sales[&quot;date&quot;].dt.to_period(&quot;M&quot;)
monthly = sales.groupby(&quot;month&quot;, as_index=False)[&quot;amount&quot;].sum()
monthly</code></pre>
<p>Pandas では、何をキーに行を合わせるか、どの列を残すかを明確にすると処理が安定します。<br>
前処理はモデル以前の品質を決めるので、読みやすい集計コードを意識して書くのが重要です。</p>

</article>
  </main>
  <script src="/highlight/highlight.min.js"></script>
  <script>
    (function () {
      if (!window.hljs) return;
      document.querySelectorAll("pre code").forEach(function (block) {
        window.hljs.highlightElement(block);
      });
    })();
  </script>
</body>
</html>