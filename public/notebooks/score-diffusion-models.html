<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>score-diffusion-models</title>
  <link rel="stylesheet" href="/highlight/atom-one-dark.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
  <style>
    :root {
      --bg-0: #f3f8fb;
      --bg-1: #d7e8f4;
      --bg-2: #f9f1e7;
      --text: #09162b;
      --muted: #44556f;
      --panel: rgba(255,255,255,.72);
      --border: rgba(255,255,255,.62);
      --code-bg: #09131a;
      --code-text: #e6f0f5;
      --shadow: 0 24px 54px rgba(10, 26, 54, 0.18), inset 0 1px 0 rgba(255,255,255,.62);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-0: #071225;
        --bg-1: #0f2238;
        --bg-2: #1a2f44;
        --text: #ebf3ff;
        --muted: #9db3cf;
        --panel: rgba(12, 21, 40, 0.74);
        --border: rgba(145, 183, 227, 0.33);
        --code-bg: #040b17;
        --code-text: #e4efff;
        --shadow: 0 30px 66px rgba(2, 7, 16, 0.58), inset 0 1px 0 rgba(166,205,255,.16);
      }
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      padding: 2rem 1rem;
      color: var(--text);
      font-family: "IBM Plex Sans", system-ui, sans-serif;
      background:
        radial-gradient(circle at 12% 12%, rgba(87,196,223,.18), transparent 44%),
        radial-gradient(circle at 88% 5%, rgba(255, 155, 96, 0.16), transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(109, 196, 255, 0.2), transparent 45%),
        linear-gradient(155deg, var(--bg-0) 0%, var(--bg-1) 48%, var(--bg-2) 100%);
    }
    main {
      max-width: 980px;
      margin: 0 auto;
      border-radius: 24px;
      border: 1px solid var(--border);
      background: var(--panel);
      backdrop-filter: blur(20px) saturate(145%);
      -webkit-backdrop-filter: blur(20px) saturate(145%);
      box-shadow: var(--shadow);
      padding: 1.25rem 1.25rem 1.5rem;
    }
    .prose-noema h1, .prose-noema h2, .prose-noema h3 {
      line-height: 1.25;
      margin-top: 1.25rem;
      margin-bottom: .65rem;
    }
    .prose-noema h1 { margin-top: .1rem; font-size: 1.8rem; }
    .prose-noema h2 { font-size: 1.35rem; }
    .prose-noema p {
      line-height: 1.85;
      color: var(--text);
      margin: .7rem 0;
    }
    .prose-noema ul, .prose-noema ol {
      margin: .7rem 0;
      padding-left: 1.4rem;
    }
    .prose-noema ul { list-style: disc; }
    .prose-noema ol { list-style: decimal; }
    .prose-noema li { margin: .28rem 0; line-height: 1.72; }
    .prose-noema a { color: inherit; text-underline-offset: 2px; }
    .prose-noema pre {
      background: var(--code-bg);
      color: var(--code-text);
      border-radius: 12px;
      padding: 1rem;
      overflow: auto;
      border: 1px solid rgba(255,255,255,.12);
    }
    .prose-noema code {
      font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, monospace;
    }
    .prose-noema img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <main>
<article class="prose-noema">
<h1 id="スコアベースモデルと拡散モデル">スコアベースモデルと拡散モデル</h1>
<p>深層生成モデル セクションの学習ステップ 7/8。<br>
スコアベースモデルと拡散モデルでは、生成の仕組みを抽象用語で終わらせず、毎段階をコードで確認します。</p>
<p>このステップの到達目標: 生成モデルを『何を近似しているか』で比較し、用途に応じた選択理由を説明できる状態にします。<br>
前提: 確率分布と最適化の初歩、ニューラルネットワークの基礎が前提です。</p>
<p>今回の中心語: 「潜在変数」、「尤度」、「サンプリング」、「拡散」、「スコア」、「スコアベースモデルと拡散モデル」<br>
前ステップ「エネルギーベースモデル」では エネルギー地形の入口 → 単純なデコーダを書く を確認しました。<br>
ここまでに登場した語: 「潜在変数」、「尤度」、「サンプリング」、「拡散」、「スコア」、「生成モデルの全体像」、「潜在変数モデルと混合モデル」、「VAE」、「GAN」、「自己回帰モデルとフローベースモデル」<br>
セクション全体のゴール: 生成モデルを『何を近似しているか』で比較し、用途に応じた選択理由を説明できる状態にします。</p>

<h2 id="観察-1-拡散向けノイズ初期化">観察 1: 拡散向けノイズ初期化</h2>
<p>スコアベースモデルではノイズ段階が鍵です。初期ノイズ列を作ります。</p>

<pre><code class="language-python">import random
random.seed(31)
z = [round(random.gauss(0, 1.2), 3) for _ in range(5)]
print(&#39;task = score-diffusion-models&#39;)
print(&#39;latent z =&#39;, z)</code></pre>
<p>ノイズから復元する流れをここから追跡します。</p>
<p>この節では、潜在変数 が入出力のどこを決めるかを中心に読める状態になれば十分です。</p>

<h2 id="観察-2-単純なデコーダを書く">観察 2: 単純なデコーダを書く</h2>
<p>次に、潜在変数を観測空間へ写像する簡易デコーダを作ります。生成モデルの基本構造をコードで可視化します。</p>

<pre><code class="language-python">weights = [1.4, -0.6, 0.8, 0.5, -1.1]
bias = 0.2
x_hat = sum(zi * wi for zi, wi in zip(z, weights)) + bias
print(&#39;decoded scalar =&#39;, round(x_hat, 5))
print(&#39;abs scale =&#39;, round(abs(x_hat), 5))</code></pre>
<p>実際の生成モデルは高次元ですが、構造は同じです。潜在を観測へ写像し、再構成品質を改善します。</p>
<p>この節では、潜在変数 が入出力のどこを決めるかを中心に読める状態になれば十分です。</p>

<h2 id="計算の対応表">計算の対応表</h2>
<ol>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>t</mi></msub><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mi mathvariant="normal">∇</mi><mi>x</mi></msub><mi>log</mi><msub><mi>p</mi><mi>t</mi></msub><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">s_t(x) = \nabla_x\log p_t(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">s</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord"><span class="mord mathrm">∇</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">t</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>x</mi><mo>=</mo><mi>f</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo>)</mo><mspace width="0.16667em"></mspace><mi>d</mi><mi>t</mi><mo>+</mo><mi>g</mi><mo>(</mo><mi>t</mi><mo>)</mo><mspace width="0.16667em"></mspace><mi>d</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">dx = f(x,t)\,dt + g(t)\,dw</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">d</span><span class="mord mathit">x</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose">)</span><span class="mord mspace thinspace"></span><span class="mord mathit">d</span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathit">t</span><span class="mclose">)</span><span class="mord mspace thinspace"></span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span></span></li>
</ol>

<h2 id="観察-3-ノイズを加えて復元する">観察 3: ノイズを加えて復元する</h2>
<p>ここで、拡散系モデルの直感を最小実験で確認します。ノイズ付加と復元の往復を短いコードで体験します。</p>

<pre><code class="language-python">x0 = 1.5
beta = 0.12
noise = -0.3
xt = ((1 - beta) ** 0.5) * x0 + (beta ** 0.5) * noise
x0_hat = (xt - (beta ** 0.5) * noise) / ((1 - beta) ** 0.5)
print(&#39;x0, xt, x0_hat =&#39;, round(x0, 5), round(xt, 5), round(x0_hat, 5))</code></pre>
<p>復元誤差を観察すると、ノイズスケジュールの意味が見えてきます。理論と実装をつなぐ重要な観測点です。</p>
<p>この節では、潜在変数 が入出力のどこを決めるかを中心に読める状態になれば十分です。</p>

<h2 id="観察-4-混合分布の感覚を作る">観察 4: 混合分布の感覚を作る</h2>
<p>次に、複数モードを持つ分布を手で作ります。モード崩壊の議論に入る前の下地として有効です。</p>

<pre><code class="language-python">mix = [(-2.0, 0.4), (1.5, 0.6)]
samples = []
for m, w in mix:
    samples.append(round(m + (w * 0.1), 3))
print(&#39;mode-aware samples =&#39;, samples)</code></pre>
<p>混合分布の直感があると、生成結果の『多様性』を定量評価する発想が自然になります。</p>
<p>この節では、潜在変数 が入出力のどこを決めるかを中心に読める状態になれば十分です。</p>

<h2 id="観察-5-学習指標を定義する">観察 5: 学習指標を定義する</h2>
<p>最後に、生成品質を観察する最小指標を作ります。見た目だけで判断しない習慣を作ることが狙いです。</p>

<pre><code class="language-python">recon_errors = [0.42, 0.31, 0.29, 0.36, 0.33]
avg = sum(recon_errors) / len(recon_errors)
worst = max(recon_errors)
best = min(recon_errors)
print(&#39;avg/best/worst =&#39;, round(avg, 4), round(best, 4), round(worst, 4))</code></pre>
<p>平均値と外れ値を同時に見ると、モデルが安定しているかを判断しやすくなります。</p>
<p>この節では、潜在変数 が入出力のどこを決めるかを中心に読める状態になれば十分です。</p>

<h2 id="要点整理">要点整理</h2>
<p>今回のノートで押さえておくべき誤解しやすい点を整理します。</p>
<ol>
<li>見た目の良さだけで比較してしまう</li>
<li>多様性と品質のトレードオフを観測しない</li>
<li>ノイズスケジュールの意味を理解しないまま調整する</li>
</ol>
<p>次は学習ステップ 8/8「連続時間拡散モデルとフローマッチング理論」へ進み、今回のコードとの差分を確認してください。</p>

</article>
  </main>
  <script src="/highlight/highlight.min.js"></script>
  <script>
    (function () {
      if (!window.hljs) return;
      document.querySelectorAll("pre code").forEach(function (block) {
        window.hljs.highlightElement(block);
      });
    })();
  </script>
</body>
</html>